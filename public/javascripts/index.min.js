function ProcessEncode(){var a=0;$("#new-file .percent").text("Aguardando ...");var b=setInterval(function(){$.ajax({url:"/zstatus",type:"GET",dataType:"JSON",success:function(c){a++,c.error?(console.log("Ocorreu um erro"),NewFile.setError(),clearInterval(b)):(console.log(c.nome+" | "+c.percent),(""!=c.nome||c.percent>0)&&$("#new-file .percent").text(c.percent+"%"),100==c.percent&&(clearInterval(b),console.log(c),NewFile.setNewFile(),NewFile.setSuccess(c.url,c.url.split(".mp4")[0]+".png",c.filename))),a>=2e3&&confirm("O zencoder está demorando tempo demais para converter o arquivo... Deseja cancelar a ação?")&&(NewFile.setError(),clearInterval(b))},error:function(){NewFile.setError(),clearInterval(b)}})},2e3)}function LoadVideos(){var a=0/0,b=document.URL.split("/videos/");2==b.length&&(a=parseInt(b[1])),$.ajax({url:"/listavideos",dataType:"JSON",success:function(b){for(var c=0,d=0;d<b.Contents.length;d++){var e="",f=!1;b.Contents[d].Key.split(".mp4")[0]==b.Contents[d+1].Key.split(".png")[0]&&(e=b.Contents[d+1].Key,f=!0);var g=b.Contents[d].Key.split(".mp4")[0].split("zen-")[1],h='<div class="col-lg-2 col-md-4 col-xs-6 thumb">\n	                <a class="thumbnail thumbnail-done" href="https://s3.amazonaws.com/upload.sambatech/'+b.Contents[d].Key+'" data-title="'+g+'">\n	                    <img src="https://s3.amazonaws.com/upload.sambatech/'+e+'" alt="">\n	                </a>\n	                <span class="title-video">'+g+"</span>\n                </div>";c==a&&(Modal.setVideo("https://s3.amazonaws.com/upload.sambatech/"+b.Contents[d].Key,g),Modal.open()),f&&d++,c++,$("#sec-videos .row").append(h)}}})}$(function(){LoadVideos(),$(".wrap-modal").on("click",function(a){("wrap-modal-video"==a.target.id||"row"==a.target.className)&&Modal.close()}),$(".wrap-modal .wrap-video .btn-close-bar").on("click",function(a){a.preventDefault(),Modal.close()}),$("#sec-videos").on("click",".thumbnail-done, .new",function(a){a.preventDefault(),$("#wrap-modal-video").find("video").attr("src",$(this).attr("href")),$("#wrap-modal-video").find("video-title").text($(this).attr("data-title")),$("#wrap-modal-video").css({display:"block",opacity:1}),setTimeout(function(){$("#wrap-modal-video").find("video").trigger("play")},500)}),$('.thumbnail.new-file input[name="myFile"]').on("dragenter",function(){$(this).closest(".thumbnail").addClass("dragenter")}).on("dragleave",function(){$(this).closest(".thumbnail").removeClass("dragenter")}),$("#myFile").on("change",function(){$(this).closest("form").submit()}),$("form").on("submit",function(a){a.preventDefault(),NewFile.setLoading();var b=new FormData,c=document.getElementById("myFile").files[0];b.append("myFile",c);var d=new XMLHttpRequest;d.open("post","/",!0),d.upload.onprogress=function(a){if(a.lengthComputable){var b=a.loaded/a.total*100;b.toFixed(2),NewFile.setLoadingPercent(b+"%"),b>=100&&NewFile.setLoadingPercent("Salvando...")}},d.onerror=function(a){console.log(a),NewFile.setError(),console.log("Ocorreu um erro durante o envio do arquivo. Talvez a conexão tenha sido interrompida.")},d.onload=function(){ProcessEncode()},d.send(b)})}),Modal={},Modal.self=$("#wrap-modal-video"),Modal.video=Modal.self.find("video"),Modal.close=function(){Modal.self.css("opacity",0),Modal.self.find("video").trigger("pause"),setTimeout(function(){Modal.self.css("display","none")},500)},Modal.open=function(){Modal.self.css({display:"block",opacity:1}),Modal.video.trigger("play")},Modal.setVideo=function(a,b){Modal.self.find(".video-title").text(b),Modal.video.attr("src",a)};var $newFile=$("#new-file"),NewFile={};NewFile.setNewFile=function(){$newFile.removeClass().addClass("thumbnail new-file").empty().html('<span class="glyphicon glyphicon-cloud-upload"></span>\n                <strong>Upload new file</strong>\n                <span>Drap & Drop a file here.</span>\n				\n				<form action="">\n                	<input type="file" name="video" >\n                </form>')},NewFile.setError=function(){$newFile.removeClass("loading dragenter").addClass("error").empty().html('<img src="../images/bad.png" alt="">\n           		<strong>Sorry, something is wrong</strong>')},NewFile.setLoading=function(){$newFile.removeClass("new-file").addClass("loading").empty().html('<span>Your media is transfering.</span>\n                    <img src="../images/loading.gif" class="loading" />\n                    <span class="percent">Aguardando...</span>')},NewFile.setLoadingPercent=function(a){$newFile.find("percent").text(a)},NewFile.setSuccess=function(a,b,c){var d=($newFile.closest(".div"),$('<div class="col-lg-2 col-md-4 col-xs-6 thumb">\n	                <a class="thumbnail success" href="'+a+'">\n		                <div class="overlay-sucess">\n	                		<strong>Upload Completed</strong>\n	                		<span>Edit Informations</span>\n	                	</div>\n	                    \n	                </a>\n	                <span class="title-video">'+c+"</span>\n                </div>"));d.insertAfter($("#new-file").closest("div")),$img=$('<img src="'+b+'" alt="">'),$img.on("load",function(){d.find("a.thumbnail").append($(this))}),setTimeout(function(){NewFile.setNew(d.find("a.thumbnail"))},2e3)},NewFile.setNew=function(a){a.removeClass("success").addClass("new").find(".overlay-sucess").css("opacity",0),setTimeout(function(){a.find(".overlay-sucess").remove()},500)};